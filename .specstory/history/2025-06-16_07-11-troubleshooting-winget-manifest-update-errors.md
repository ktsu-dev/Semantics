<!-- Generated by SpecStory -->

# Troubleshooting winget manifest update errors (2025-06-16 17:11:48)

_**User**_

the winget script is still causing an error even though this is a library and it should gracefully exit:

Updating winget manifests for ktsu.Semantics version 1.0.16...
Fetching release information from GitHub...
Found release: v1.0.16
Downloading Semantics-1.0.16-win-x64.zip to calculate SHA256...
Warning: Failed to download or hash Semantics-1.0.16-win-x64.zip: Not Found
Skipping this architecture. If required, please provide the correct artifact name pattern.
Downloading Semantics-1.0.16-win-x86.zip to calculate SHA256...
Warning: Failed to download or hash Semantics-1.0.16-win-x86.zip: Not Found
Skipping this architecture. If required, please provide the correct artifact name pattern.
Downloading Semantics-1.0.16-win-arm64.zip to calculate SHA256...
Warning: Failed to download or hash Semantics-1.0.16-win-arm64.zip: Not Found
Skipping this architecture. If required, please provide the correct artifact name pattern.
Write-Error: C:\a\_temp\7f043196-2571-473f-9c5e-c426bb209a78.ps1:4
Line |
   4 |  .\scripts\update-winget-manifests.ps1 -Version "1.0.16"
     |  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     | Could not obtain any SHA256 hashes. Please check that the artifact name pattern matches your release files.
Error: Process completed with exit code 1.

---

_**Assistant**_



---

I need to examine the winget script that's causing this error. Let me first explore the project structure to find the script and understand what's happening.

---

<details>
            <summary>Listed current directory â€¢ **36** results</summary>
        
| Name |
|-------|
| ğŸ“ `.git` |
| ğŸ“„ `VERSION.md` |
| ğŸ“„ `CHANGELOG.md` |
| ğŸ“„ `Directory.Packages.props` |
| ğŸ“„ `COPYRIGHT.md` |
| ğŸ“ `coverage` |
| ğŸ“ `Semantics.Test` |
| ğŸ“„ `.runsettings` |
| ğŸ“„ `global.json` |
| ğŸ“„ `.gitignore` |
| ğŸ“„ `.gitattributes` |
| ğŸ“ `scripts` |
| ğŸ“„ `.editorconfig` |
| ğŸ“„ `TAGS.md` |
| ğŸ“„ `README.md` |
| ğŸ“„ `DESCRIPTION.md` |
| ğŸ“ `Semantics` |
| ğŸ“ `docs` |
| ğŸ“ `TestResults` |
| ğŸ“ `obj` |
| ğŸ“ `bin` |
| ğŸ“„ `AUTHORS.md` |
| ğŸ“ `.sonarlint` |
| ğŸ“ `.vscode` |
| ğŸ“ `.specstory` |
| ğŸ“„ `.cursorignore` |
| ğŸ“ `.cursor` |
| ğŸ“ `.vs` |
| ğŸ“„ `LICENSE.md` |
| ğŸ“„ `PROJECT_URL.url` |
| ğŸ“„ `Semantics.sln` |
| ğŸ“ `.github` |
| ğŸ“„ `.cursorindexingignore` |
| ğŸ“„ `.mailmap` |
| ğŸ“„ `AUTHORS.url` |
| ğŸ“„ `icon.png` |

</details>

---

I can see there's a `scripts/` directory. Let me examine it to find the winget script:

---

<details>
            <summary>Listed directory scripts â€¢ **5** results</summary>
        
| Name |
|-------|
| ğŸ“„ `update-winget-manifests.ps1` |
| ğŸ“„ `PSBuild.psm1` |
| ğŸ“„ `README.md` |
| ğŸ“„ `PSBuild.psd1` |
| ğŸ“„ `LICENSE.template` |

</details>

---

Perfect! Let me examine the `update-winget-manifests.ps1` script to understand what's happening:

---

Read file: scripts/update-winget-manifests.ps1

---

Let me continue reading the script to see how it handles library detection and the exit logic:

---

Read file: scripts/update-winget-manifests.ps1

---

Now let me see the remaining part of the script to understand the complete flow:

---

Read file: scripts/update-winget-manifests.ps1

---

Now let me check what type of project this is by looking at the `.csproj` files to see if it's indeed a library:

---

<details>
            <summary>Listed directory Semantics â€¢ **8** results</summary>
        
| Name |
|-------|
| ğŸ“ `obj` |
| ğŸ“„ `Semantics.csproj` |
| ğŸ“ `Quantities` |
| ğŸ“ `Validation` |
| ğŸ“ `Strings` |
| ğŸ“ `Paths` |
| ğŸ“ `Utilities` |
| ğŸ“ `bin` |

</details>

---

Read file: Semantics/Semantics.csproj

---



---

<details>
            <summary>Listed directory Semantics.Test â€¢ **27** results</summary>
        
| Name |
|-------|
| ğŸ“ `obj` |
| ğŸ“„ `PerformanceRegressionTests.cs` |
| ğŸ“„ `SemanticQuantityTests.cs` |
| ğŸ“„ `SemanticStringFactoryTests.cs` |
| ğŸ“„ `SemanticStringTests.cs` |
| ğŸ“„ `PerformanceBenchmarks.cs` |
| ğŸ“„ `ElectricalQuantitiesTests.cs` |
| ğŸ“„ `ThermalAcousticQuantitiesTests.cs` |
| ğŸ“„ `PathValidationAttributeTests.cs` |
| ğŸ“„ `TextValidationAttributesTests.cs` |
| ğŸ“„ `AdvancedAttributeValidationTests.cs` |
| ğŸ“„ `SemanticPathTests.cs` |
| ğŸ“„ `ValidationStrategyTests.cs` |
| ğŸ“„ `ErrorHandlingTests.cs` |
| ğŸ“„ `AttributeValidationTests.cs` |
| ğŸ“„ `AdvancedErrorScenarioTests.cs` |
| ğŸ“„ `AdvancedUtilityTests.cs` |
| ğŸ“„ `AdvancedIntegrationTests.cs` |
| ğŸ“„ `PhysicalConstantsTests.cs` |
| ğŸ“„ `IntegrationTests.cs` |
| ğŸ“„ `MechanicalQuantitiesTests.cs` |
| ğŸ“„ `SemanticStringExtensionsTests.cs` |
| ğŸ“„ `UtilityTests.cs` |
| ğŸ“„ `SemanticPathInterfaceTests.cs` |
| ğŸ“„ `FluentValidationAdapterTests.cs` |
| ğŸ“ `bin` |
| ğŸ“„ `Semantics.Test.csproj` |

</details>

---

Read file: Semantics.Test/Semantics.Test.csproj

---



---

Now I understand the issue. This is indeed a library project (using `ktsu.Sdk.Lib` and `ktsu.Sdk.Test`), not an executable application. The script has logic to detect library-only projects and exit gracefully, but it seems like this detection is happening too late in the process - after it's already tried to download artifacts.

Looking at the error output and the script, the issue is in line 831 where it checks if there are no SHA256 hashes:

```
if ($sha256Hashes.Count -eq 0) {
    # Check if this appears to be a library-only project (no executable artifacts)
    if (Test-IsLibraryOnlyProject -RootDir $rootDir -ProjectInfo $projectInfo) {
        Exit-GracefullyForLibrary
    } else {
        Write-Error "Could not obtain any SHA256 hashes. Please check that the artifact name pattern matches your release files."
        exit 1
    }
}
```

However, there's already an early check on line 711:

```
# Early check for library-only projects to avoid unnecessary processing
if (Test-IsLibraryOnlyProject -RootDir $rootDir -ProjectInfo $projectInfo) {
    Exit-GracefullyForLibrary -Message "Detected library-only solution with no applications."
}
```

The problem is that the `Test-IsLibraryOnlyProject` function isn't correctly detecting this as a library project. Let me check what it's looking for:

---

Read file: scripts/update-winget-manifests.ps1

---

The issue is clear now. The `Test-IsLibraryOnlyProject` function is looking for specific patterns in the `.csproj` files to detect libraries, but this project uses custom SDK files (`ktsu.Sdk.Lib` and `ktsu.Sdk.Test`). The function isn't recognizing these as library indicators.

The function checks for:
- `<OutputType>Library</OutputType>`
- `<PackageId>`
- `<GeneratePackageOnBuild>true</GeneratePackageOnBuild>`
- `<IsPackable>true</IsPackable>`

But this project uses `Sdk="ktsu.Sdk.Lib"` which should be recognized as a library SDK. Let me fix this:

---



---

I also need to update the application detection to exclude test projects:

---



---



---

Now let's test the script to see if it properly detects this as a library project:

---

```bash
cd /c%3A/dev/ktsu-dev/Semantics && powershell -ExecutionPolicy Bypass -File scripts/update-winget-manifests.ps1 -Version "1.0.16"
```

```
C:\dev\ktsu-dev\Semantics>cd /c%3A/dev/ktsu-dev/Semantics && powershell -ExecutionPolicy Bypass -File scripts/update-winget-manifests.ps1 -Version "1.0.16"
Microsoft Windows [Version 10.0.26100.4351]
(c) Microsoft Corporation. All rights reserved.

C:\dev\ktsu-dev\Semantics>cd /c%3A/dev/ktsu-dev/Semantics && powershell -ExecutionPolicy Bypass -File scripts/update-winget-manifests.ps1 -Version "1.0.16"
The system cannot find the path specified.

C:\dev\ktsu-dev\Semantics>




















C:\dev\ktsu-dev\Semantics>
```

---



---

Let me try again with the correct path format for Windows:

---

```bash
powershell -ExecutionPolicy Bypass -File scripts\update-winget-manifests.ps1 -Version "1.0.16"
```

```
The script 'update-winget-manifests.ps1' cannot be run because it contained a "#requires" statement for Windows PowerShell 7.0. The version of Windows PowerShell that is required by the 
script does not match the currently running version of Windows PowerShell 5.1.26100.4202.
    + CategoryInfo          : ResourceUnavailable: (update-winget-manifests.ps1:String) [], ParentContainsErrorRecordException
    + FullyQualifiedErrorId : ScriptRequiresUnmatchedPSVersion

C:\dev\ktsu-dev\Semantics>
```

---



---

Let me try with PowerShell 7:

---

```bash
pwsh -ExecutionPolicy Bypass -File scripts\update-winget-manifests.ps1 -Version "1.0.16"
```

```
Detected GitHub repository: ktsu-dev/Semantics
Error evaluating MSBuild properties: Unable to find type [Microsoft.Build.Evaluation.ProjectProperty].
Falling back to XML parsing.
Falling back to parsing csproj XML
Detected project: ktsu.Semantics (Type: csharp)
Detected library-only solution with no applications.
Skipping winget manifest generation as this appears to be a library/NuGet package.
Winget manifests are intended for executable applications, not libraries.

C:\dev\ktsu-dev\Semantics>
```

---



---

Perfect! The script is now working correctly. It detected this as a library-only solution and exited gracefully with exit code 0 instead of causing an error. The fix I made added recognition for custom SDK patterns like `ktsu.Sdk.Lib` and `ktsu.Sdk.Test`.

Here's a summary of what I fixed:

1. **Enhanced library detection**: The script now recognizes projects using custom SDK files that contain `.Lib` or `Library` in their name (like `ktsu.Sdk.Lib`)

2. **Enhanced application detection exclusion**: The script now excludes projects using custom SDK files that contain `.Test`, `.Lib`, `Test`, or `Library` from being considered as applications

3. **Early exit**: The script now properly detects library-only projects early in the process and exits gracefully before attempting to download any artifacts

The key changes were:
- Added patterns to detect library SDKs: `'Sdk="[^"]*\.Lib"'` and `'Sdk="[^"]*Library[^"]*"'`
- Added exclusion patterns for test and library SDKs in the application detection logic

Now when the script runs on this library project, it correctly identifies it as a library-only solution and exits with a clear message instead of trying to download non-existent executable artifacts and failing with an error.

---

